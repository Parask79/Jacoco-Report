<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SentimentAnalysisScreen.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.example.logger.presentation.sentiment</a> &gt; <span class="el_source">SentimentAnalysisScreen.kt</span></div><h1>SentimentAnalysisScreen.kt</h1><pre class="source lang-java linenums">package com.example.logger.presentation.sentiment

import androidx.compose.foundation.Canvas
import androidx.compose.foundation.background
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.shape.CircleShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.outlined.ArrowBack
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.ElevatedCard
import androidx.compose.material3.ExperimentalMaterial3Api
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.material3.TopAppBar
import androidx.compose.material3.TopAppBarDefaults
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.geometry.Offset
import androidx.compose.ui.geometry.Size
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.semantics.contentDescription
import androidx.compose.ui.semantics.semantics
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun SentimentAnalysisScreen(
    pos: Int,
    neu: Int,
    neg: Int,
    onNavigateBack: () -&gt; Unit
<span class="pc bpc" id="L47" title="12 of 22 branches missed.">) {</span>
<span class="pc bpc" id="L48" title="1 of 2 branches missed.">    Scaffold(</span>
<span class="fc" id="L49">        topBar = {</span>
            TopAppBar(
                title = { Text(&quot;Sentiment Analysis&quot;, color = MaterialTheme.colorScheme.onPrimary) },
                navigationIcon = {
                    IconButton(onClick = onNavigateBack) {
                        Icon(
                            imageVector = Icons.AutoMirrored.Outlined.ArrowBack,
                            contentDescription = &quot;Back&quot;,
                            tint = MaterialTheme.colorScheme.onPrimary
                        )
                    }
                },
                colors = TopAppBarDefaults.topAppBarColors(containerColor = MaterialTheme.colorScheme.primary)
            )
        }
<span class="fc" id="L64">    ) { padding -&gt;</span>
        Column(
            modifier = Modifier
                .padding(padding)
                .fillMaxSize()
                .padding(16.dp),
            verticalArrangement = Arrangement.spacedBy(16.dp)
        ) {
            ElevatedCard(
                modifier = Modifier.fillMaxWidth(),
                elevation = CardDefaults.elevatedCardElevation(defaultElevation = 8.dp)
            ) {
                Column(modifier = Modifier.fillMaxWidth().padding(16.dp), verticalArrangement = Arrangement.spacedBy(12.dp)) {
                    Text(
                        text = &quot;Overall sentiment distribution&quot;,
                        style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.SemiBold)
                    )

                    Spacer(modifier = Modifier.height(8.dp))
                    PieChart(
                        positive = pos,
                        neutral = neu,
                        negative = neg,
                        modifier = Modifier
                            .fillMaxWidth()
                            .height(180.dp)
                            .semantics { contentDescription = &quot;Sentiment pie chart&quot; }
                    )
                    Spacer(modifier = Modifier.height(8.dp))

                    LegendRow(pos = pos, neu = neu, neg = neg)
                }
            }
        }
    }
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">}</span>

@Composable
private fun PieChart(
    positive: Int,
    neutral: Int,
    negative: Int,
<span class="pc bpc" id="L106" title="1 of 2 branches missed.">    modifier: Modifier = Modifier</span>
<span class="pc bpc" id="L107" title="10 of 30 branches missed.">) {</span>
<span class="fc" id="L108">    val total = (positive + neutral + negative).coerceAtLeast(1)</span>
<span class="fc" id="L109">    val posAngle = 360f * (positive / total.toFloat())</span>
<span class="fc" id="L110">    val neuAngle = 360f * (neutral / total.toFloat())</span>
<span class="fc" id="L111">    val negAngle = 360f * (negative / total.toFloat())</span>

<span class="fc" id="L113">    Box(modifier = modifier, contentAlignment = Alignment.Center) {</span>
<span class="fc" id="L114">        Canvas(modifier = Modifier.fillMaxSize()) {</span>
<span class="fc" id="L115">            val diameter = size.minDimension</span>
<span class="fc" id="L116">            val left = (size.width - diameter) / 2f</span>
<span class="fc" id="L117">            val top = (size.height - diameter) / 2f</span>
<span class="fc" id="L118">            val chartSize = Size(diameter, diameter)</span>
<span class="fc" id="L119">            var startAngle = -90f</span>

            // Positive - Green
<span class="fc bfc" id="L122" title="All 2 branches covered.">            if (posAngle &gt; 0f) {</span>
<span class="fc" id="L123">                drawArc(</span>
<span class="fc" id="L124">                    color = Color(0xFF4CAF50),</span>
<span class="fc" id="L125">                    startAngle = startAngle,</span>
<span class="fc" id="L126">                    sweepAngle = posAngle,</span>
<span class="fc" id="L127">                    useCenter = true,</span>
<span class="fc" id="L128">                    topLeft = Offset(left, top),</span>
<span class="fc" id="L129">                    size = chartSize</span>
                )
            }
<span class="fc" id="L132">            startAngle += posAngle</span>

            // Neutral - Amber
<span class="fc bfc" id="L135" title="All 2 branches covered.">            if (neuAngle &gt; 0f) {</span>
<span class="fc" id="L136">                drawArc(</span>
<span class="fc" id="L137">                    color = Color(0xFFFFC107),</span>
<span class="fc" id="L138">                    startAngle = startAngle,</span>
<span class="fc" id="L139">                    sweepAngle = neuAngle,</span>
<span class="fc" id="L140">                    useCenter = true,</span>
<span class="fc" id="L141">                    topLeft = Offset(left, top),</span>
<span class="fc" id="L142">                    size = chartSize</span>
                )
            }
<span class="fc" id="L145">            startAngle += neuAngle</span>

            // Negative - Red
<span class="fc bfc" id="L148" title="All 2 branches covered.">            if (negAngle &gt; 0f) {</span>
<span class="fc" id="L149">                drawArc(</span>
<span class="fc" id="L150">                    color = Color(0xFFF44336),</span>
<span class="fc" id="L151">                    startAngle = startAngle,</span>
<span class="fc" id="L152">                    sweepAngle = negAngle,</span>
<span class="fc" id="L153">                    useCenter = true,</span>
<span class="fc" id="L154">                    topLeft = Offset(left, top),</span>
<span class="fc" id="L155">                    size = chartSize</span>
                )
            }
<span class="fc" id="L158">        }</span>
<span class="fc" id="L159">    }</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">}</span>

@Composable
<span class="pc bpc" id="L163" title="5 of 18 branches missed.">private fun LegendRow(pos: Int, neu: Int, neg: Int) {</span>
<span class="fc" id="L164">    val total = (pos + neu + neg).coerceAtLeast(1)</span>
<span class="fc" id="L165">    Row(</span>
<span class="fc" id="L166">        modifier = Modifier.fillMaxWidth(),</span>
<span class="fc" id="L167">        horizontalArrangement = Arrangement.SpaceBetween,</span>
<span class="fc" id="L168">        verticalAlignment = Alignment.CenterVertically</span>
    ) {
<span class="fc" id="L170">        LegendItem(color = Color(0xFF4CAF50), label = &quot;Positive&quot;, count = pos, total = total)</span>
<span class="fc" id="L171">        LegendItem(color = Color(0xFFFFC107), label = &quot;Neutral&quot;, count = neu, total = total)</span>
<span class="fc" id="L172">        LegendItem(color = Color(0xFFF44336), label = &quot;Negative&quot;, count = neg, total = total)</span>
<span class="fc" id="L173">    }</span>
<span class="pc bpc" id="L174" title="1 of 2 branches missed.">}</span>

@Composable
<span class="pc bpc" id="L177" title="15 of 22 branches missed.">private fun LegendItem(color: Color, label: String, count: Int, total: Int) {</span>
<span class="fc" id="L178">    val percentage = ((count / total.toFloat()) * 100).toInt()</span>
<span class="fc" id="L179">    Row(verticalAlignment = Alignment.CenterVertically) {</span>
<span class="fc" id="L180">        Box(modifier = Modifier.size(10.dp).clip(CircleShape).background(color))</span>
<span class="fc" id="L181">        Spacer(modifier = Modifier.size(6.dp))</span>
<span class="fc" id="L182">        Text(</span>
<span class="fc" id="L183">            text = &quot;$label: $count (${percentage}%)&quot;,</span>
<span class="fc" id="L184">            style = MaterialTheme.typography.bodySmall,</span>
<span class="fc" id="L185">            color = MaterialTheme.colorScheme.onSurfaceVariant</span>
        )
<span class="fc" id="L187">    }</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>